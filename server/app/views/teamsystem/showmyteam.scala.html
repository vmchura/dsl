@import play.api.i18n.Messages
@import play.api.mvc.RequestHeader
@import controllers.AssetsFinder

@import models.teamsystem.TeamWithUsers

@import views.html.teamsystem.showteam
@import models.teamsystem.InvitationMeta
@import models.teamsystem.MemberStatus
@import shared.models.DiscordID
@import views.html.helper.CSPNonce
@(userID: DiscordID, team: TeamWithUsers, inviteForm: Form[InvitationMeta], queryForm: Form[String])(implicit request: RequestHeader, messages: Messages,  assetsFinder: AssetsFinder)
<div class="my-team-box">
    @showteam(team)

    @if(userID == team.principal.discordID){

        <div class="my-team-configuration">
            <div id="find-members">
                @helper.inputText(queryForm("query"),
                    Symbol("id") -> "input-query-id",
                    Symbol("class") -> "form-control",
                    Symbol("_label") -> "Buscar miembro para invitarlo: ")
                <button id="search-member-button" class="btn btn-primary">Buscar</button>
            </div>


            @helper.form(action = controllers.teamsystem.routes.TeamManagerController.doInvitation(team.teamID.id),
                Symbol("id") -> "invitation-box") {
                @helper.CSRF.formField
                @helper.select(inviteForm("to"),
                    options = Nil,
                    Symbol("id") -> "members-option-id",
                    Symbol("class") -> "form-select",
                    Symbol("_label") -> "Invitar a: ")
                @helper.select(inviteForm("status"),
                    options = List(MemberStatus.Official,MemberStatus.Suplente).map(e => (e.name, e. name)),
                    Symbol("class") -> "form-select",
                    Symbol("id") -> "members-status-id",
                    Symbol("_label") -> "¿Oficial o Suplente?: ")

                <button type="submit" id="members-invite-id" class="btn btn-primary">Invitar</button>
            }
            <script @{CSPNonce.attr}>
                    Main.initMemberFinder();
            </script>

            <div class="container-fluid" id="invitation-results-id">
                @request.flash.get("invitation-error").map { msg =>
                    <div class="alert alert-danger" role="alert">
                        ¡Error!: @msg
                    </div>
                }
                @request.flash.get("invitation-success").map { msg =>
                    <div class="alert alert-success" role="alert">
                        !Hecho! @msg
                    </div>
                }
            </div>

        </div>
    }


    <div class="team-quit">
        @helper.form(action = controllers.teamsystem.routes.TeamManagerController.quitTeam(team.teamID.id)) {
            @helper.CSRF.formField
            <button  class="btn btn-danger"  type="submit">Retirarme del equipo @{team.teamName}</button>
        }

        @if(userID == team.principal.discordID){
            <div class="alert alert-danger" role="alert">
                Eres el principal miembro del equipo, si te retiras el equipo se eliminará.
            </div>
        }

    </div>

</div>
